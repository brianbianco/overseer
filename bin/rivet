#!/usr/bin/env ruby
# encoding: UTF-8

$:.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))
require 'rivet'

DEBUG = Logger::DEBUG
WARN  = Logger::WARN
FATAL = Logger::FATAL
INFO  = Logger::INFO

# Default option values
options             = OpenStruct.new
options.log_level   = INFO
options.profile     = 'default'
options.config_path = File.join('.', 'autoscale')

OptionParser.new do |o|
  o.on('-l', '--log-level [LEVEL]', String, 'specify the log level (default is INFO)') do |l|
    options.log_level = Kernel.const_get l.upcase
  end

  o.on('-p', '--profile [PROFILE_NAME]', 'Selects the AWS profile to use (default is "default")') do |p|
    options.profile = p
  end

  o.on('-s', '--sync', 'Sync the changes remotely to AWS') do |s|
    options.sync = s
  end

  o.on('-c', '--config-path [PATH]', 'The configuration path to use (default is ./autoscale)') do |c|
    options.config_path = c
  end

  o.on('-g', '--group [GROUP_NAME]', String, 'Autoscaling group name') do |g|
    options.group = g
  end

  o.on('-h') { Rivet::Log.info o; exit }

  begin
    o.parse!
  rescue OptionParser::InvalidOption, OptionParser::MissingArgument
    Rivet::Log.fatal $!.to_s
    Rivet::Log.fatal o
    exit 255
  end
end

Rivet::AutoscaleClient.new.run(options)

